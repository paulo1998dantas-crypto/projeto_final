<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Checklist</title>
</head>
<body class="bg-slate-50">
    <header class="bg-slate-900 p-4 sticky top-0 z-50 flex justify-between items-center text-white">
        <a href="/" class="text-yellow-400 font-bold">← VOLTAR</a>
        <img src="/static/logo.png" class="h-6">
    </header>

    <main class="p-4 max-w-md mx-auto">
        <div class="bg-white p-5 rounded-2xl shadow-sm mb-6 border-l-4 border-blue-600">
            <h1 class="text-xl font-black text-slate-800 uppercase">{{ veiculo.modelo }}</h1>
            <p class="text-xs text-slate-400">CHASSI: {{ veiculo.chassi }}</p>
        </div>

        <div class="space-y-3">
            {% for etapa in etapas %}
            <div class="bg-white p-4 rounded-xl border flex justify-between items-center shadow-sm">
                <span class="font-bold text-slate-700 text-[11px] uppercase">{{ etapa }}</span>
                <div class="flex gap-1">
                    <button onclick="salvar('{{ etapa }}', 'N/A', this)" class="w-10 h-10 rounded-lg font-bold text-[9px] border-b-2 {% if status_map.get(etapa) == 'N/A' %} bg-slate-600 text-white border-slate-800 {% else %} bg-slate-100 text-slate-400 border-slate-300 {% endif %}">N/A</button>
                    <button onclick="salvar('{{ etapa }}', 'NÃO', this)" class="w-10 h-10 rounded-lg font-bold text-[9px] border-b-2 {% if status_map.get(etapa) == 'NÃO' %} bg-red-500 text-white border-red-700 {% else %} bg-slate-100 text-slate-400 border-slate-300 {% endif %}">X</button>
                    <button onclick="salvar('{{ etapa }}', 'SIM', this)" class="w-10 h-10 rounded-lg font-bold text-[9px] border-b-2 {% if status_map.get(etapa) == 'SIM' %} bg-green-500 text-white border-green-700 {% else %} bg-slate-100 text-slate-400 border-slate-300 {% endif %}">OK</button>
                </div>
            </div>
            {% endfor %}
        </div>
    </main>

    <script>
    async function salvar(etapa, status, btn) {
        const payload = { chassi: "{{ veiculo.chassi }}", etapa: etapa, status: status };
        const res = await fetch('/apontar', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(payload) });
        if (res.ok) {
            btn.parentElement.querySelectorAll('button').forEach(b => {
                b.className = "w-10 h-10 rounded-lg font-bold text-[9px] border-b-2 bg-slate-100 text-slate-400 border-slate-300";
            });
            if (status === 'SIM') btn.className = "w-10 h-10 rounded-lg font-bold text-[9px] border-b-2 bg-green-500 text-white border-green-700";
            else if (status === 'NÃO') btn.className = "w-10 h-10 rounded-lg font-bold text-[9px] border-b-2 bg-red-500 text-white border-red-700";
            else btn.className = "w-10 h-10 rounded-lg font-bold text-[9px] border-b-2 bg-slate-600 text-white border-slate-800";
        }
    }
    </script>
</body>
</html>